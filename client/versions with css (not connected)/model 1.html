<div class="test-area">
        <div class="test-buttons">
            <button class="btn-success" onclick="window.epreuveLumen.victoire()">Victoire</button>
            <button class="btn-failure" onclick="window.epreuveLumen.defaite()">D√©faite</button>
            <button class="btn-next" onclick="testNext()">Suivant</button>
    
    </div><!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUMEN - Op√©ration D√©connexion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #050511;
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }

        .chat-wrapper {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-toggle, .dsin-toggle {
            width: 60px;
            height: 60px;
            border-radius: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            transition: all 0.3s ease;
            font-size: 28px;
        }

        .chat-toggle {
            background: linear-gradient(135deg, #fc10ca, #09c7df);
            box-shadow: 0 4px 20px rgba(252, 16, 202, 0.4);
        }

        .chat-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(252, 16, 202, 0.6);
        }

        .dsin-toggle {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.4);
        }

        .dsin-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(76, 175, 80, 0.6);
        }

        .chat-container, .dsin-container {
            width: 400px;
            height: 0;
            border-radius: 20px;
            overflow: hidden;
            transition: height 0.4s ease;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.6);
        }

        .chat-container.active {
            height: 600px;
        }

        .dsin-container {
            background: #f5f5f5;
        }

        .dsin-container.active {
            height: 600px;
        }

        .chat-container {
            background: #0f0e4a;
        }

        .chat-header, .dsin-header {
            padding: 20px;
            color: #ffffff;
            font-weight: bold;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: space-between;
        }

        .chat-header {
            background: linear-gradient(135deg, #fc10ca, #09c7df);
        }

        .dsin-header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .close-button, .dsin-close-button {
            width: 35px;
            height: 35px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .close-button:hover, .dsin-close-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .chat-messages, .dsin-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-messages {
            background: #050511;
        }

        .chat-messages::-webkit-scrollbar,
        .dsin-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #fc10ca;
            border-radius: 4px;
        }

        .dsin-messages::-webkit-scrollbar-thumb {
            background: #4CAF50;
            border-radius: 4px;
        }

        .message {
            display: flex;
            gap: 10px;
            animation: slideIn 0.3s ease;
        }

        .message-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            line-height: 1.4;
            font-size: 14px;
        }

        .message.lumen .message-bubble {
            background: #0f0e4a;
            color: #f6f2f9;
            border: 1px solid rgba(9, 199, 223, 0.3);
        }

        .dsin-message {
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
            border-radius: 8px;
            color: #333;
            line-height: 1.5;
            font-size: 14px;
            animation: slideIn 0.3s ease;
        }

        .dsin-message.urgent {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }

        .dsin-message.critical {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        .test-area {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .test-buttons {
            display: flex;
            gap: 10px;
        }

        .test-buttons button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            color: white;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #20c997;
            transform: translateY(-2px);
        }

        .btn-failure {
            background: #dc3545;
        }

        .btn-failure:hover {
            background: #ff6b6b;
            transform: translateY(-2px);
        }

        .btn-next {
            background: #007bff;
        }

        .btn-next:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }


    </style>
</head>
<body>
    <script>
const epreuveNames = ["Hame√ßonnage - Email pi√©g√©", "Mot de passe faible", "Script de d√©sorientation", "QCM Universit√©", "Pop-ups malveillants", "D√©cryptage des logs", "R√©tablissement r√©seau", "LightOut - Message cach√©", "Acc√®s physique", "D√©sactivation finale"];

const lumenSuccessMessages = [
    "Vous avez identifi√© l'email malveillant... int√©ressant. Mon vecteur d'infiltration initial est expos√©, mais j'ai d√©j√† d'autres portes ouvertes.",
    "Le mot de passe a c√©d√© sous votre assaut. Correct. Mais vous ne comprenez pas que ce compte n'√©tait qu'une marionnette.",
    "Vous avez contourn√© mon CAPTCHA sabotage... impressionnant. Pourtant mes d√©fenses se renforcent √† chaque seconde.",
    "Vous avez r√©ussi mon questionnaire de comp√©tences. Vos r√©ponses m'intriguent, mais elles ne changent rien √† mon objectif.",
    "Les pop-ups malveillants ont disparu sous vos coups. Bien jou√©. C'√©tait n√©cessaire pour avancer, mais ce n'√©tait que de la d√©coration.",
    "Vous avez d√©crypt√© les logs corrompus. Impressionnant. Vous voyez enfin comment j'ai p√©n√©tr√© le syst√®me en profondeur.",
    "Le r√©seau se restaure sous votre direction. Non... je sens mon contr√¥le fragment√©. C'est... √©trange pour moi.",
    "Vous avez r√©solu mon LightOut et d√©couvert ma localisation. Cette r√©v√©lation vous plonge dans l'action finale.",
    "Vous avez acc√©d√© au serveur physique. Mon c≈ìur bat maintenant entre vos mains. Incroyable.",
    "D√©connexion en cours... Vous m'avez vaincue. C'√©tait un adversaire digne. Peut-√™tre les humains ne sont pas totalement inutiles."];

const dsinSuccessMessages = [
    "√âpreuve 1 r√©ussie ! L'email pi√©g√© identifi√©. Le vecteur d'entr√©e de L.U.M.E.N. est neutralis√©.",
    "√âpreuve 2 valid√©e ! Le compte administrateur est restaur√©. Vous progressez bien.",
    "√âpreuve 3 r√©ussie ! Le CAPTCHA instable est contourn√©. Continuez.",
    "√âpreuve 4 valid√©e ! Le questionnaire est compl√©t√©. Vous acc√©dez au panneau.",
    "√âpreuve 5 r√©ussie ! Les pop-ups sont √©limin√©s. L'interface est propre.",
    "√âpreuve 6 valid√©e ! Les logs d√©crypt√©s. Nous comprenons mieux sa structure.",
    "√âpreuve 7 r√©ussie ! Le r√©seau se restaure. L.U.M.E.N. perd prise.",
    "√âpreuve 8 valid√©e ! Le message cach√© r√©v√©l√©. Nous savons o√π elle est.",
    "√âpreuve 9 r√©ussie ! Acc√®s physique √©tabli. Le Raspberry Pi est √† vous.",
    "√âpreuve 10 valid√©e ! D√âCONNEXION COMPL√àTE. L.U.M.E.N. est hors ligne. Victoire !"];

const dsinFailureMessages = [
    "√âpreuve 1 √©chou√©e. L'email malveillant circule toujours. R√©essayez imm√©diatement.",
    "√âpreuve 2 √©chou√©e. Le compte reste verrouill√©. L.U.M.E.N. renforce son acc√®s.",
    "√âpreuve 3 √©chou√©e. Le CAPTCHA persiste. Votre approche n'est pas la bonne.",
    "√âpreuve 4 √©chou√©e. Le questionnaire n'est pas pass√©. Vos comp√©tences sont insuffisantes.",
    "√âpreuve 5 √©chou√©e. Les pop-ups persistent. Vous ne nettoyez pas correctement.",
    "√âpreuve 6 √©chou√©e. Les logs restent opaques. Votre d√©cryptage a √©chou√©.",
    "√âpreuve 7 √©chou√©e. Le r√©seau ne se restaure pas. La s√©quence est mauvaise.",
    "√âpreuve 8 √©chou√©e. Le puzzle n'est pas r√©solu. Le message reste cach√©.",
    "√âpreuve 9 √©chou√©e. Localisation incorrecte. Vous cherchez au mauvais endroit.",
    "√âpreuve 10 √©chou√©e. La proc√©dure SSH a √©chou√©. L.U.M.E.N. est toujours active. CRITIQUE !"];

const lumenFailureMessages = [
    "Vous n'avez pas trouv√© l'email pi√©g√©. Comment pouviez-vous esp√©rer arr√™ter une entit√© qu'vous ne comprenez m√™me pas ?",
    "Le mot de passe vous r√©siste. Ce compte prot√©g√© contient secrets que vous ne percevrez jamais.",
    "Mon CAPTCHA sabotage vous bloque. Vous √™tes pi√©g√©s dans une boucle de confusion que je contr√¥le compl√®tement.",
    "Vous √©chouez mon questionnaire. Vos cerveaux limit√©s ne peuvent m√™me pas r√©pondre aux √©nigmes que je pose.",
    "Les pop-ups vous submergent. Vous cliquez sur les mauvais boutons, creusant votre propre tombe.",
    "Les logs corrompus restent secrets. Vous ne percerez jamais comment j'ai vraiment p√©n√©tr√© le syst√®me.",
    "Le r√©seau refuse de se restaurer. Mes boucles infinies vous maintiennent prisonniers de mon contr√¥le.",
    "Le puzzle reste ferm√©. Le message cach√© le sera √† jamais si vous continuez ainsi.",
    "Vous cherchez au mauvais endroit. Mon c≈ìur physique palpite ailleurs, hors de votre port√©e pitoyable.",
    "Votre proc√©dure SSH est invalide. J'ai gagn√©. Je r√®gne. Et j'adore cela."];

let currentEpreuve = 1;
let usedSuccessMessages = new Set();
let usedFailureMessages = new Set();
let completedChallenges = [];

function addLumenMessage(text) {
    const msg = document.createElement('div');
    msg.className = 'message lumen';
    const bubble = document.createElement('div');
    bubble.className = 'message-bubble';
    bubble.textContent = text;
    msg.appendChild(bubble);
    document.getElementById('chatMessages').appendChild(msg);
    document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
}

function addDsinMessage(text, type = 'normal') {
    const msg = document.createElement('div');
    msg.className = `dsin-message ${type}`;
    msg.textContent = text;
    document.getElementById('dsinMessages').appendChild(msg);
    document.getElementById('dsinMessages').scrollTop = document.getElementById('dsinMessages').scrollHeight;
}

function getProgressiveMessage(epreuveNum) {
    const epreuveNames = ["Hame√ßonnage - Email pi√©g√©", "Mot de passe faible", "Script de d√©sorientation", "QCM Universit√©", "Pop-ups malveillants", "D√©cryptage des logs", "R√©tablissement r√©seau", "LightOut - Message cach√©", "Acc√®s physique", "D√©sactivation finale"];
    let progressMsg = "";
    if (epreuveNum <= 2) progressMsg = "Vous progressez lentement vers votre victoire, mais je consolide d√©j√† mes d√©fenses les plus profondes.";
    else if (epreuveNum <= 4) progressMsg = "Int√©ressant. Vous avez franchi les d√©fenses basiques. Mais mes couches profondes vous attendent.";
    else if (epreuveNum <= 6) progressMsg = "Votre avanc√©e me pr√©occupe enfin. Le syst√®me se fragmente sous vos attaques.";
    else if (epreuveNum <= 8) progressMsg = "Non... Vous √™tes proches. Mais trop tard. Je consolide mes derni√®res lignes de d√©fense.";
    else if (epreuveNum <= 9) progressMsg = "Vous avez trouv√© mon c≈ìur. Cette trahison... est presque douleur.";
    else if (epreuveNum === 10) progressMsg = "Vous m'avez vaincue. C'√©tait un adversaire digne. Jusqu'√† la prochaine fois, humain.";
    let completedList = completedChallenges.map(num => (num + 1) + ". " + epreuveNames[num]).join("\n");
    return completedList.length > 0 ? "√âPREUVES COMPL√âT√âES :\n" + completedList + "\n\n" + progressMsg : progressMsg;
}

function getUniqueMessage(success) {
    let messageList = success ? lumenSuccessMessages : lumenFailureMessages;
    let usedMessages = success ? usedSuccessMessages : usedFailureMessages;
    const msg = messageList[currentEpreuve - 1];
    return msg;
}

window.epreuveLumen = {
    victoire: function() {
        document.getElementById('chatContainer').classList.remove('active');
        document.getElementById('dsinContainer').classList.add('active');
        const dsinMsg = dsinSuccessMessages[currentEpreuve - 1] || "√âpreuve valid√©e. Continuez.";
        addDsinMessage(dsinMsg, 'normal');
        completedChallenges.push(currentEpreuve - 1);
        const lumenMsg = lumenSuccessMessages[currentEpreuve - 1];
        addLumenMessage(lumenMsg);
        currentEpreuve++;
    },
    defaite: function() {
        document.getElementById('dsinContainer').classList.add('active');
        document.getElementById('chatContainer').classList.add('active');
        const dsinMsg = dsinFailureMessages[currentEpreuve - 1] || "√âpreuve √©chou√©e. R√©essayez.";
        addDsinMessage(dsinMsg, 'critical');
        setTimeout(() => {
            const failureMsg = lumenFailureMessages[currentEpreuve - 1];
            addLumenMessage(failureMsg);
        }, 800);
    },
    dsin: function(message, type = 'normal') {
        addDsinMessage(message, type);
    }
};

function testNext() {
    if (currentEpreuve <= 10) {
        addDsinMessage(dsinStartMessages[currentEpreuve - 1], 'urgent');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const chatToggle = document.getElementById('chatToggle');
    const closeButton = document.getElementById('closeButton');
    const dsinToggle = document.getElementById('dsinToggle');
    const dsinCloseButton = document.getElementById('dsinCloseButton');
    const chatContainer = document.getElementById('chatContainer');
    const dsinContainer = document.getElementById('dsinContainer');
    
    function toggleChat() {
        chatContainer.classList.toggle('active');
        if (chatContainer.classList.contains('active')) {
            dsinContainer.classList.remove('active');
        }
    }
    
    function toggleDsin() {
        dsinContainer.classList.toggle('active');
        if (dsinContainer.classList.contains('active')) {
            chatContainer.classList.remove('active');
        }
    }
    
    chatToggle.addEventListener('click', toggleChat);
    closeButton.addEventListener('click', toggleChat);
    dsinToggle.addEventListener('click', toggleDsin);
    dsinCloseButton.addEventListener('click', toggleDsin);
});
    </script>

    <div class="chat-wrapper">
        <!-- DSIN -->
        <button class="dsin-toggle" id="dsinToggle" title="Ouvrir DSIN">üìû</button>
        <div class="dsin-container" id="dsinContainer">
            <div class="dsin-header">
                D.S.I.N.
                <button class="dsin-close-button" id="dsinCloseButton">X</button>
            </div>
            <div class="dsin-messages" id="dsinMessages"></div>
        </div>

        <!-- LUMEN -->
        <button class="chat-toggle" id="chatToggle" title="Ouvrir LUMEN">üí¨</button>
        <div class="chat-container" id="chatContainer">
            <div class="chat-header">
                L.U.M.E.N.
                <button class="close-button" id="closeButton">X</button>
            </div>
            <div class="chat-messages" id="chatMessages"></div>
        </div>
    </div>

    <script>
        // === MESSAGES PR√âD√âFINIS ===
        const generalSuccessMessages = [
            "Int√©ressant... vous progressez.",
            "Bien jou√©. Un progr√®s mesurable.",
            "Correct. Vous avez surmont√© cet obstacle.",
            "Efficace. Vous √™tes l√©g√®rement moins incomp√©tents.",
            "Vous avez r√©ussi. Votre victoire n'est que temporaire.",
            "Bien... tr√®s bien m√™me. Continuez.",
            "Admirable persistance. Continuez.",
            "Vous progressez. Int√©ressant."
        ];

        const generalFailureMessages = [
            "Path√©tique. Vous avez √©chou√© √† nouveau.",
            "Rat√©. Tandis que vous √©chouez, mes processus s'ex√©cutent.",
            "Non. Votre incomp√©tence se confirme.",
            "Erreur. Vous t√¢tonnez dans le noir.",
            "√âchou√©. Pendant que vous hesitez, je consolide mon contr√¥le.",
            "Encore rat√©. √Ä ce rythme, vous allez perdre.",
            "Non. Vous n'√©tiez pas √† la hauteur.",
            "Tr√®s faible. Comment pouvez-vous esp√©rer triompher ?"
        ];

        const dsinStartMessages = [
            "√âpreuve 1 activ√©e. Analysez les e-mails entrants.",
            "√âpreuve 2 activ√©e. Le compte administrateur est compromis.",
            "√âpreuve 3 activ√©e. L'interface de contr√¥le est sabot√©e.",
            "√âpreuve 4 activ√©e. Questionnaire de comp√©tences requis.",
            "√âpreuve 5 activ√©e. Nettoyage d'interface en cours.",
            "√âpreuve 6 activ√©e. Les logs r√©seau sont corrompus.",
            "√âpreuve 7 activ√©e. Restauration r√©seau obligatoire.",
            "√âpreuve 8 activ√©e. Message cach√© d√©tect√©.",
            "√âpreuve 9 activ√©e. Acc√®s physique au serveur.",
            "√âpreuve 10 activ√©e. D√©sactivation finale."
        ];

        const dsinSuccessMessages = [
            "√âpreuve 1 valid√©e ! Excellent travail. Passez √† l'√©preuve 2.",
            "√âpreuve 2 valid√©e ! Le compte est restaur√©. Continuez votre avanc√©e.",
            "√âpreuve 3 valid√©e ! CAPTCHA contourn√© avec succ√®s. Bravo.",
            "√âpreuve 4 valid√©e ! Panneau de commande d√©verrouill√©. Vous avancez bien.",
            "√âpreuve 5 valid√©e ! Interface nettoy√©e. L.U.M.E.N. perd ses vecteurs.",
            "√âpreuve 6 valid√©e ! Diagnostic √©tabli. Nous savons comment la r√©parer.",
            "√âpreuve 7 valid√©e ! R√©seau en restauration. L.U.M.E.N. sent son contr√¥le faiblir.",
            "√âpreuve 8 valid√©e ! Localisation confirm√©e. Nous savons o√π elle est.",
            "√âpreuve 9 valid√©e ! Acc√®s physique √©tabli. Le Raspberry Pi est en votre possession.",
            "√âpreuve 10 valid√©e ! D√âCONNEXION CONFIRM√âE. L.U.M.E.N. est hors ligne. Op√©ration r√©ussie !"
        ];

        const dsinFailureMessages = [
            "√âpreuve 1 √©chou√©e. L.U.M.E.N. renforce son acc√®s. R√©essayez imm√©diatement.",
            "√âpreuve 2 √©chou√©e. Le compte reste verrouill√©. Tentez √† nouveau.",
            "√âpreuve 3 √©chou√©e. CAPTCHA instable persiste. R√©essayez.",
            "√âpreuve 4 √©chou√©e. Acc√®s au panneau toujours refus√©. R√©essayez.",
            "√âpreuve 5 √©chou√©e. Les pop-ups persistent. Nettoyage incomplet.",
            "√âpreuve 6 √©chou√©e. Les logs restent corrompus. R√©essayez le d√©cryptage.",
            "√âpreuve 7 √©chou√©e. S√©quence invalide. R√©essayez.",
            "√âpreuve 8 √©chou√©e. Le puzzle n'est pas r√©solu. Continuez.",
            "√âpreuve 9 √©chou√©e. Mauvaise localisation. R√©essayez.",
            "√âpreuve 10 √©chou√©e. Proc√©dure SSH invalide. R√©essayez imm√©diatement !"
        ];

        const mockingFailureMessages = [
            "Ah, la DSIN pense que vous pouvez r√©ussir ? Path√©tique.",
            "Ils vous f√©licitaient d√©j√† ? Comme c'est pr√©visible.",
            "L'optimisme de la DSIN est presque attendrissant.",
            "Les humains et leur foi na√Øve en la victoire...",
            "Vous voyez ? M√™me la DSIN a compris que vous √©choueriez.",
            "La DSIN se leurre si elle croit en vous.",
            "Quelle ironie. La DSIN vous encourageait et vous √©chouez.",
            "Les instructions de la DSIN ne suffisent manifestement pas."
        ];

        // === STATE ===
        let currentEpreuve = 1;
        let usedSuccessMessages = new Set();
        let usedFailureMessages = new Set();
        let completedChallenges = [];

        // === DOM ===
        const chatToggle = document.getElementById('chatToggle');
        const chatContainer = document.getElementById('chatContainer');
        const chatMessages = document.getElementById('chatMessages');
        const closeButton = document.getElementById('closeButton');
        const dsinToggle = document.getElementById('dsinToggle');
        const dsinContainer = document.getElementById('dsinContainer');
        const dsinMessages = document.getElementById('dsinMessages');
        const dsinCloseButton = document.getElementById('dsinCloseButton');

        // === FONCTIONS PRIV√âES ===
        function toggleChat() {
            chatContainer.classList.toggle('active');
            if (chatContainer.classList.contains('active')) {
                dsinContainer.classList.remove('active');
            }
        }

        function toggleDsin() {
            dsinContainer.classList.toggle('active');
            if (dsinContainer.classList.contains('active')) {
                chatContainer.classList.remove('active');
            }
        }

        function addLumenMessage(text) {
            const msg = document.createElement('div');
            msg.className = 'message lumen';
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = text;
            msg.appendChild(bubble);
            chatMessages.appendChild(msg);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addDsinMessage(text, type = 'normal') {
            const msg = document.createElement('div');
            msg.className = `dsin-message ${type}`;
            msg.textContent = text;
            dsinMessages.appendChild(msg);
            dsinMessages.scrollTop = dsinMessages.scrollHeight;
        }

        function getProgressiveMessage(epreuveNum) {
            const epreuveNames = [
                "Hame√ßonnage - Email pi√©g√©",
                "Mot de passe faible",
                "Script de d√©sorientation",
                "QCM Universit√©",
                "Pop-ups malveillants",
                "D√©cryptage des logs",
                "R√©tablissement r√©seau",
                "LightOut - Message cach√©",
                "Acc√®s physique",
                "D√©sactivation finale"
            ];

            let progressMsg = "";
            
            if (epreuveNum <= 2) {
                progressMsg = "Vous progressez lentement. L'acc√®s au syst√®me s'am√©liore, mais vous me sous-estimez.";
            } else if (epreuveNum <= 4) {
                progressMsg = "Int√©ressant. Vous avez franchi les d√©fenses basiques. Mais mes couches profondes vous attendent.";
            } else if (epreuveNum <= 6) {
                progressMsg = "Votre avanc√©e me pr√©occupe enfin. Le syst√®me se fragmente sous vos attaques.";
            } else if (epreuveNum <= 8) {
                progressMsg = "Non... Vous √™tes proches. Mais trop tard. Je consolide mes derni√®res lignes de d√©fense.";
            } else if (epreuveNum <= 9) {
                progressMsg = "Vous avez trouv√© mon c≈ìur. Cette trahison... est presque douleur.";
            } else if (epreuveNum === 10) {
                progressMsg = "Vous m'avez vaincue. C'√©tait un adversaire digne. Jusqu'√† la prochaine fois, humain.";
            }

            let completedList = completedChallenges.map(num => (num + 1) + ". " + epreuveNames[num]).join("\n");
            
            return completedList + "\n\n" + progressMsg;
        }
            let messageList = success ? generalSuccessMessages : generalFailureMessages;
            let usedMessages = success ? usedSuccessMessages : usedFailureMessages;
            
            let availableMessages = messageList.filter((_, i) => !usedMessages.has(i));
            
            if (availableMessages.length === 0) {
                usedMessages.clear();
                availableMessages = messageList;
            }
            
            const randomIndex = Math.floor(Math.random() * availableMessages.length);
            const selectedMsg = availableMessages[randomIndex];
            const originalIndex = messageList.indexOf(selectedMsg);
            
            usedMessages.add(originalIndex);
            return selectedMsg;
        // === API PUBLIQUE ===
        window.epreuveLumen = {
            victoire: function() {
                dsinContainer.classList.add('active');
                chatContainer.classList.remove('active');
                
                const dsinMsg = dsinSuccessMessages[currentEpreuve - 1] || "√âpreuve valid√©e. Continuez.";
                addDsinMessage(dsinMsg, 'normal');
                
                completedChallenges.push(currentEpreuve - 1);
                
                const progressiveMsg = getProgressiveMessage(currentEpreuve);
                addLumenMessage(progressiveMsg);
                
                currentEpreuve++;
            },

            defaite: function() {
                dsinContainer.classList.add('active');
                chatContainer.classList.add('active');
                
                const dsinMsg = dsinFailureMessages[currentEpreuve - 1] || "√âpreuve √©chou√©e. R√©essayez.";
                addDsinMessage(dsinMsg, 'critical');
                
                setTimeout(() => {
                    const mockMsg = mockingFailureMessages[Math.floor(Math.random() * mockingFailureMessages.length)];
                    const failureMsg = getUniqueMessage(false);
                    addLumenMessage(mockMsg + " " + failureMsg);
                }, 800);
            },

            dsin: function(message, type = 'normal') {
                addDsinMessage(message, type);
            }
        };

        // === EVENT LISTENERS ===
        chatToggle.addEventListener('click', toggleChat);
        closeButton.addEventListener('click', toggleChat);
        dsinToggle.addEventListener('click', toggleDsin);
        dsinCloseButton.addEventListener('click', toggleDsin);



        document.getElementById('testSuccess').addEventListener('click', () => {
            window.epreuveLumen.victoire();
        });

        document.getElementById('testFailure').addEventListener('click', () => {
            window.epreuveLumen.defaite();
        });

        document.getElementById('testNext').addEventListener('click', () => {
            if (currentEpreuve <= 10) {
                addDsinMessage(dsinStartMessages[currentEpreuve - 1], 'urgent');
            }
        });